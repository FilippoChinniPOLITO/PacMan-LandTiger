#include "pacman_utils.h"


/* (Private) System Imports */

#include <string.h>


/* (Private) Hardware Imports */

//#include "../interfaces/hw_abstraction.h"		// Transitive Import


/* (Private) User Imports */

#include "pacman_core.h"


/* (Private) Constants Definitions */

const GameMap map_1 = {
	{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
	{1, 4, 4, 4, 4, 4, 4, 0, 0, 0, 1, 1, 4, 4, 4, 4, 1, 1, 0, 0, 0, 4, 4, 4, 4, 4, 4, 1},
	{1, 4, 1, 1, 1, 1, 4, 1, 1, 0, 1, 1, 4, 1, 1, 4, 1, 1, 0, 1, 1, 4, 1, 1, 1, 1, 4, 1},
	{1, 4, 1, 1, 1, 1, 4, 1, 1, 0, 1, 1, 4, 1, 1, 4, 1, 1, 0, 1, 1, 4, 1, 1, 1, 1, 4, 1},
	{1, 4, 1, 1, 1, 1, 4, 1, 1, 0, 1, 1, 4, 1, 1, 4, 1, 1, 0, 1, 1, 4, 1, 1, 1, 1, 4, 1},
	{1, 4, 4, 4, 4, 4, 4, 1, 1, 0, 4, 4, 4, 1, 1, 4, 4, 4, 0, 1, 1, 4, 4, 4, 4, 4, 4, 1},
	{1, 4, 1, 1, 4, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 4, 1, 1, 4, 1},
	{1, 4, 1, 1, 4, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 4, 1, 1, 4, 1},
	{1, 4, 1, 1, 4, 4, 4, 0, 0, 0, 0, 0, 0, 4, 4, 0, 0, 0, 0, 0, 0, 4, 4, 4, 1, 1, 4, 1},
	{1, 4, 1, 1, 1, 1, 4, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 4, 1, 1, 1, 1, 4, 1},
	{1, 4, 1, 1, 1, 1, 4, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 4, 1, 1, 1, 1, 4, 1},
	{1, 4, 1, 1, 4, 4, 4, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 4, 4, 4, 1, 1, 4, 1},
	{1, 4, 1, 1, 4, 1, 1, 1, 1, 0, 1, 1, 1, 0, 0, 1, 1, 1, 0, 1, 1, 1, 1, 4, 1, 1, 4, 1},
	{1, 4, 1, 1, 4, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 1, 1, 1, 1, 4, 1, 1, 4, 1},
	{1, 4, 4, 4, 4, 4, 4, 1, 1, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 1, 1, 4, 4, 4, 4, 4, 4, 1},
	{1, 4, 1, 1, 1, 1, 4, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 4, 1, 1, 1, 1, 4, 1},
	{1, 4, 1, 1, 1, 1, 4, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 4, 1, 1, 1, 1, 4, 1},
	{1, 4, 1, 1, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 4, 1},
	{1, 4, 1, 1, 4, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 4, 1, 1, 4, 1},
	{1, 4, 1, 1, 4, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 4, 1, 1, 4, 1},
	{2, 0, 0, 0, 4, 4, 4, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 4, 4, 4, 0, 0, 0, 3},
	{1, 4, 1, 1, 1, 1, 4, 1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1, 4, 1, 1, 1, 1, 4, 1},
	{1, 4, 1, 1, 1, 1, 4, 1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1, 4, 1, 1, 1, 1, 4, 1},
	{1, 4, 4, 4, 4, 4, 4, 0, 0, 0, 1, 1, 4, 4, 4, 4, 1, 1, 0, 0, 0, 4, 4, 4, 4, 4, 4, 1},
	{1, 4, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 4, 1},
	{1, 4, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 4, 1},
	{1, 4, 1, 1, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 4, 1},
	{1, 4, 1, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 1, 4, 1},
	{1, 4, 1, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 1, 4, 1},
	{1, 4, 4, 4, 4, 4, 4, 4, 1, 1, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 4, 4, 4, 4, 4, 4, 4, 1},
	{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}
};

const GameMap map_2 = {
	{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
	{1, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1},
	{1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1},
	{1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1},
	{1, 4, 4, 4, 4, 4, 4, 4, 1, 1, 0, 0, 4, 4, 4, 4, 0, 0, 1, 1, 4, 4, 4, 4, 4, 4, 4, 1},
	{1, 4, 1, 1, 1, 1, 1, 4, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 1, 4, 1, 1, 1, 1, 1, 4, 1},
	{1, 4, 1, 1, 1, 1, 1, 4, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 1, 4, 1, 1, 1, 1, 1, 4, 1},
	{1, 4, 1, 1, 4, 4, 4, 4, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 4, 4, 4, 4, 1, 1, 4, 1},
	{1, 4, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 4, 1},
	{1, 4, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 4, 1},
	{1, 4, 0, 0, 4, 1, 1, 4, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 4, 1, 1, 4, 0, 0, 4, 1},
	{1, 4, 1, 1, 4, 1, 1, 4, 4, 4, 0, 0, 0, 0, 0, 0, 0, 0, 4, 4, 4, 1, 1, 4, 1, 1, 4, 1},
	{1, 4, 1, 1, 4, 1, 1, 1, 1, 4, 1, 1, 1, 0, 0, 1, 1, 1, 4, 1, 1, 1, 1, 4, 1, 1, 4, 1},
	{1, 4, 1, 1, 4, 1, 1, 1, 1, 4, 1, 1, 0, 0, 0, 0, 1, 1, 4, 1, 1, 1, 1, 4, 1, 1, 4, 1},
	{1, 4, 1, 1, 4, 4, 4, 4, 4, 4, 1, 1, 0, 0, 0, 0, 1, 1, 4, 4, 4, 4, 4, 4, 1, 1, 4, 1},
	{1, 4, 1, 1, 1, 1, 0, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 0, 1, 1, 1, 1, 4, 1},
	{1, 4, 1, 1, 1, 1, 0, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 0, 1, 1, 1, 1, 4, 1},
	{1, 4, 4, 4, 0, 0, 0, 1, 1, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 0, 0, 0, 4, 4, 4, 1},
	{1, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 1},
	{1, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 1},
	{2, 0, 0, 4, 4, 4, 4, 1, 1, 4, 4, 4, 4, 1, 1, 4, 4, 4, 4, 1, 1, 4, 4, 4, 4, 0, 0, 3},
	{1, 0, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 0, 1},
	{1, 0, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 0, 1},
	{1, 0, 1, 1, 0, 0, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 0, 0, 1, 1, 0, 1},
	{1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0, 1},
	{1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0, 1},
	{1, 4, 4, 4, 4, 4, 4, 1, 1, 0, 1, 1, 4, 4, 4, 4, 1, 1, 0, 1, 1, 4, 4, 4, 4, 4, 4, 1},
	{1, 4, 1, 1, 1, 1, 4, 1, 1, 0, 1, 1, 4, 1, 1, 4, 1, 1, 0, 1, 1, 4, 1, 1, 1, 1, 4, 1},
	{1, 4, 1, 1, 1, 1, 4, 1, 1, 0, 1, 1, 4, 1, 1, 4, 1, 1, 0, 1, 1, 4, 1, 1, 1, 1, 4, 1},
	{1, 4, 4, 4, 4, 4, 4, 1, 1, 0, 4, 4, 4, 1, 1, 4, 4, 4, 0, 1, 1, 4, 4, 4, 4, 4, 4, 1},
	{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}
};

const GameMap map_3 = {
	{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
	{1, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1},
	{1, 4, 1, 1, 1, 1, 4, 1, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 1, 4, 1, 1, 1, 1, 4, 1},
	{1, 4, 1, 1, 1, 1, 4, 1, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 1, 4, 1, 1, 1, 1, 4, 1},
	{1, 4, 1, 1, 1, 1, 4, 1, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 1, 4, 1, 1, 1, 1, 4, 1},
	{1, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1},
	{1, 4, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 4, 1},
	{1, 4, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 4, 1},
	{1, 4, 4, 4, 4, 4, 4, 1, 1, 4, 4, 4, 4, 1, 1, 4, 4, 4, 4, 1, 1, 4, 4, 4, 4, 4, 4, 1},
	{1, 1, 1, 1, 1, 1, 4, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 4, 1, 1, 1, 1, 1, 1},
	{1, 1, 1, 1, 1, 1, 4, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 4, 1, 1, 1, 1, 1, 1},
	{1, 1, 1, 1, 1, 1, 4, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 4, 1, 1, 1, 1, 1, 1},
	{1, 1, 1, 1, 1, 1, 4, 1, 1, 0, 1, 1, 1, 0, 0, 1, 1, 1, 0, 1, 1, 4, 1, 1, 1, 1, 1, 1},
	{1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1},
	{2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3},
	{1, 1, 1, 1, 1, 1, 4, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 4, 1, 1, 1, 1, 1, 1},
	{1, 1, 1, 1, 1, 1, 4, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 4, 1, 1, 1, 1, 1, 1},
	{1, 1, 1, 1, 1, 1, 4, 1, 1, 0, 4, 4, 4, 4, 4, 4, 4, 4, 0, 1, 1, 4, 1, 1, 1, 1, 1, 1},
	{1, 1, 1, 1, 1, 1, 4, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 4, 1, 1, 1, 1, 1, 1},
	{1, 1, 1, 1, 1, 1, 4, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 4, 1, 1, 1, 1, 1, 1},
	{1, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1},
	{1, 4, 1, 1, 1, 1, 4, 1, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 1, 4, 1, 1, 1, 1, 4, 1},
	{1, 4, 1, 1, 1, 1, 4, 1, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 1, 4, 1, 1, 1, 1, 4, 1},
	{1, 4, 4, 4, 1, 1, 4, 0, 0, 0, 0, 0, 4, 4, 4, 4, 0, 0, 0, 0, 0, 4, 1, 1, 4, 4, 4, 1},
	{1, 1, 1, 4, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 4, 1, 1, 1},
	{1, 1, 1, 4, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 4, 1, 1, 1},
	{1, 4, 4, 4, 4, 4, 4, 1, 1, 4, 4, 4, 4, 1, 1, 4, 4, 4, 4, 1, 1, 4, 4, 4, 4, 4, 4, 1},
	{1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1},
	{1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 1},
	{1, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1},
	{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}
};


/* (Private) Functions Prototypes */

void copy_map(GameMap* dest, const GameMap* source);


/* Functions Implementations */

void get_game_map(GameMap* map_to_init, const unsigned char map_id) {
	switch(map_id) {
		case(1):
			copy_map(map_to_init, &map_1);
			break;
		case(2):
			copy_map(map_to_init, &map_2);
			break;
		case(3):
			copy_map(map_to_init, &map_3);
			break;
		default:
			copy_map(map_to_init, &map_1);
			break;
	}
}

void copy_map(GameMap* dest, const GameMap* source) {
	memcpy(dest, source, sizeof(GameMap));	
}

Position get_pacman_spawn(const unsigned char map_id) {
	switch(map_id) {
		case(1):	
			return (Position) {.y=20, .x=11};
		case(2):
			return (Position) {.y=28, .x=9};
		case(3):
			return (Position) {.y=23, .x=8};
		default:
			return (Position) {.y=20, .x=11};
		}
}

Position get_blinky_spawn(const unsigned char map_id) {
	switch(map_id) {
		case(1):	
			return (Position) {.y=11, .x=14};
		case(2):
			return (Position) {.y=11, .x=14};
		case(3):
			return (Position) {.y=11, .x=14};
		default:
			return (Position) {.y=11, .x=14};
		}
}

unsigned int speed_to_timer_count(unsigned char speed_value) {
	return seconds_to_timer_count(TICK_SPEED_CONV * ((TICK_SECOND_RATIO * 2) - speed_value));
}

unsigned int seconds_to_timer_count(float seconds) {
	return ((unsigned int) (seconds * SYSTEM_FREQUENCY));
}

unsigned short seconds_to_ticks(unsigned short seconds) {
	return ((unsigned short) (seconds / TICK_DURATION));
}

float ticks_to_seconds(unsigned char ticks) {
	return (((float) ticks) * TICK_DURATION);
}

